var Postgrest=function(e,t){"use strict";function n(){var n={},o=e.prop(),u=function(e,n){return n&&t.isFunction(n.config)?t.compose(n.config,e):e},a=function(e){return function(n){return t.each(e,function(e,t){n.setRequestHeader(t,e)}),n}},c=function(e,n){return t.extend({},n,{config:u(a(e),n)})},s=function(n,r){var o=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=e.prop(o),u=e.deferred();return i.load=function(){return i(!0),e.redraw(),n(t.extend({},r,{background:!0})).then(function(t){i(!1),u.resolve(t),e.redraw()},function(t){i(!1),u.reject(t),e.redraw()}),u.promise},i},l={Prefer:"return=representation"};return n.token=o,n.init=function(r,i){var u=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};n.request=function(n){var o=function(e){try{return e.responseText}catch(t){return JSON.stringify({hint:null,details:null,code:0,message:e.responseText})}};return e.request(c(u,t.extend({extract:o},n,{url:r+n.url})))};var a=e.prop(!1);return n.authenticate=function(r){var u=r||e.deferred();return o()?u.resolve({token:o()}):a()?setTimeout(function(){return n.authenticate(u)},250):(a(!0),e.request(t.extend({},i)).then(function(e){a(!1),o(e.token),u.resolve({token:o()})})["catch"](function(e){a(!1),u.reject(e)})),u.promise},n.requestWithToken=function(e){return n.authenticate().then(function(){return n.request(c({Authorization:"Bearer "+o()},e))},function(){return n.request(e)})},n.loader=t.partial(s,n.request),n.loaderWithToken=t.partial(s,n.requestWithToken),n.model=function(r){var o=function(e,t){if(t){var n=function(){var n=(e-1)*t,r=n+t-1;return n+"-"+r};return{"Range-unit":"items",Range:n()}}},i=e.prop(10),u={url:"/"+r},a=function(e,n,r,i){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},s=t.extend({},{Prefer:"count=none"},a,o(n,r));return c(s,t.extend({},i,u,{method:"GET",data:e}))},s=function(t,n){return n.url+="?"+e.route.buildQueryString(t),n},f=function(e){return n.request(t.extend({},e,u,{method:"OPTIONS"}))},d=function(e,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=t.extend({},l,r);return c(o,t.extend({},n,u,{method:"POST",data:e}))},p=function(e,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=t.extend({},l,r);return s(e,c(o,t.extend({},n,u,{method:"DELETE"})))},h=function(e,n,r){var o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},i=t.extend({},l,o);return s(e,c(i,t.extend({},r,u,{method:"PATCH",data:n})))},v=function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return a(e,t||1,i(),n,r)},g=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return a(e,1,1,t,n)};return{pageSize:i,getPageOptions:v,getRowOptions:g,patchOptions:h,postOptions:d,deleteOptions:p,getPage:t.compose(n.request,v),getRow:t.compose(n.request,g),patch:t.compose(n.request,h),post:t.compose(n.request,d),deleteRequest:t.compose(n.request,p),getPageWithToken:t.compose(n.requestWithToken,v),getRowWithToken:t.compose(n.requestWithToken,g),patchWithToken:t.compose(n.requestWithToken,h),postWithToken:t.compose(n.requestWithToken,d),deleteWithToken:t.compose(n.requestWithToken,p),options:f}},n},n.filtersVM=r,n.paginationVM=i,n}e=e&&e.hasOwnProperty("default")?e["default"]:e,t=t&&t.hasOwnProperty("default")?t["default"]:t;var r=function(n){var r={},o=function(){var n=e.prop(""),o=function(e){return arguments.length>0?(n(e),r):n()};return o.toFilter=function(){return t.isString(o())?o().trim():o()},o},i=t.reduce(n,function(e,t,n){return"between"===t?e[n]={lte:o(),gte:o()}:e[n]=o(),e},{order:o()}),u=function(){return t.reduce(i,function(e,r,o){if("order"!==o){var i=n[o];if(t.isFunction(r.toFilter)&&(void 0===r.toFilter()||""===r.toFilter()))return e;if("ilike"===i||"like"===i)e[o]=i+".*"+r.toFilter()+"*";else if("@@"===i)e[o]=i+"."+r.toFilter().replace(/\s+/g,"&");else if("between"===i){if(!r.lte.toFilter()&&!r.gte.toFilter())return e;e[o]=[],r.gte()&&e[o].push("gte."+r.gte.toFilter()),r.lte()&&e[o].push("lte."+r.lte.toFilter())}else"is.null"===i?e[o]=null===r.toFilter()?"is.null":"not.is.null":e[o]=i+"."+r.toFilter()}return e},{})},a=function(){var e=function(){return i.order()&&t.reduce(i.order(),function(e,t,n){return e.push(n+"."+t),e},[]).join(",")},n=e()?{order:e()}:{};return t.extend({},n,u())};return t.extend(r,i,{parameters:a,parametersWithoutOrder:u})},o=(function(){function e(e){this.value=e}function t(t){function n(e,t){return new Promise(function(n,o){var a={key:e,arg:t,resolve:n,reject:o,next:null};u?u=u.next=a:(i=u=a,r(e,t))})}function r(n,i){try{var u=t[n](i),a=u.value;a instanceof e?Promise.resolve(a.value).then(function(e){r("next",e)},function(e){r("throw",e)}):o(u.done?"return":"normal",u.value)}catch(c){o("throw",c)}}function o(e,t){switch(e){case"return":i.resolve({value:t,done:!0});break;case"throw":i.reject(t);break;default:i.resolve({value:t,done:!1})}i=i.next,i?r(i.key,i.arg):u=null}var i,u;this._invoke=n,"function"!=typeof t["return"]&&(this["return"]=void 0)}return"function"==typeof Symbol&&Symbol.asyncIterator&&(t.prototype[Symbol.asyncIterator]=function(){return this}),t.prototype.next=function(e){return this._invoke("next",e)},t.prototype["throw"]=function(e){return this._invoke("throw",e)},t.prototype["return"]=function(e){return this._invoke("return",e)},{wrap:function(e){return function(){return new t(e.apply(this,arguments))}},await:function(t){return new e(t)}}}(),function(){function e(e,t){var n=[],r=!0,o=!1,i=void 0;try{for(var u,a=e[Symbol.iterator]();!(r=(u=a.next()).done)&&(n.push(u.value),!t||n.length!==t);r=!0);}catch(c){o=!0,i=c}finally{try{!r&&a["return"]&&a["return"]()}finally{if(o)throw i}}return n}return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}()),i=function(n,r){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},u=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],a=e.prop([]),c=r||"id.desc",s=e.prop({order:c}),l=e.prop(!1),f=e.prop(1),d=e.prop(),p=u?n.getPageWithToken:n.getPage,h=e.prop(),v=function(){var n=e.deferred(),r=function(e){if(!e||0===e.status)return JSON.stringify({hint:null,details:null,code:0,message:"Connection error"});var n=e.getResponseHeader("Content-Range");if(t.isString(n)){var r=n.split("/"),i=o(r,2),u=i[0],a=i[1],c=u.split("-"),s=o(c,2),l=s[0],f=s[1],p=parseInt(f)+1||0,v=parseInt(l)||0;h(parseInt(a)),d(p-v)}try{return e.responseText}catch(g){return JSON.stringify({hint:null,details:null,code:0,message:e.responseText})}};return l(!0),p(s(),f(),{background:!0,extract:r},i).then(function(r){a(t.union(a(),r)),l(!1),n.resolve(a()),e.redraw()},function(t){l(!1),h(0),n.reject(t),e.redraw()}),n.promise},g=function(e){return s(t.extend({order:c},e)),a([]),f(1),v()},m=function(){return n.pageSize()>d()},y=function(){return f(f()+1),v()};return{collection:a,firstPage:g,isLoading:l,nextPage:y,isLastPage:m,total:h,resultsCount:d}};return n}(m,_);