var Postgrest=function(e,t){"use strict";function n(n){var o=n,u={},a=e(),c=function(e,n){return n&&t.isFunction(n.config)?t.compose(n.config,e):e},s=function(e){return function(n){return t.each(e,function(e,t){n.setRequestHeader(t,e)}),n}},l=function(e,n){return t.extend({},n,{config:c(s(e),n)})},f=function(n,r){var o=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=e(o);return i.load=function(){return new Promise(function(e,o){i(!0),n(t.extend({},r,{background:!1})).then(function(t){i(!1),e(t)})["catch"](function(e){i(!1),o(e)})})},i},d={Prefer:"return=representation"};return u.token=a,u.init=function(n,r){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};u.request=function(e){var r=function(e){try{return JSON.parse(e.responseText)}catch(t){return JSON.stringify({hint:null,details:null,code:0,message:e.responseText})}},u=l(i,t.extend({extract:r},e,{url:n+e.url}));return o.request(u)};var c=e(!1);return u.authenticate=function(e){var n=e||new Promise(function(e,n){var i=function u(){a()?e({token:a()}):c()?setTimeout(u,250):(c(!0),o.request(t.extend({},r)).then(function(t){c(!1),a(t.token),e({token:a()})})["catch"](function(e){c(!1),n(e)}))};i()});return n},u.requestWithToken=function(e){return u.authenticate().then(function(){return u.request(l({Authorization:"Bearer "+a()},e))})["catch"](function(){return u.request(e)})},u.loader=t.partial(f,u.request),u.loaderWithToken=t.partial(f,u.requestWithToken),u.model=function(n){var r=function(e,t){if(t){var n=function(){var n=(e-1)*t,r=n+t-1;return n+"-"+r};return{"Range-unit":"items",Range:n()}}},i=e(10),a={url:"/"+n},c=function(e,n,o,i){var u=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},c=t.extend({},{Prefer:"count=none"},u,r(n,o));return l(c,t.extend({},i,a,{method:"GET",data:e}))},s=function(e,t){return t.url+="?"+o.buildQueryString(e),t},f=function(e){return u.request(t.extend({},e,a,{method:"OPTIONS"}))},h=function(e,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=t.extend({},d,r);return l(o,t.extend({},n,a,{method:"POST",data:e}))},g=function(e,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=t.extend({},d,r);return s(e,l(o,t.extend({},n,a,{method:"DELETE"})))},p=function(e,n,r){var o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},i=t.extend({},d,o);return s(e,l(i,t.extend({},r,a,{method:"PATCH",data:n})))},v=function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return c(e,t||1,i(),n,r)},m=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return c(e,1,1,t,n)};return{pageSize:i,getPageOptions:v,getRowOptions:m,patchOptions:p,postOptions:h,deleteOptions:g,getPage:t.compose(u.request,v),getRow:t.compose(u.request,m),patch:t.compose(u.request,p),post:t.compose(u.request,h),deleteRequest:t.compose(u.request,g),getPageWithToken:t.compose(u.requestWithToken,v),getRowWithToken:t.compose(u.requestWithToken,m),patchWithToken:t.compose(u.requestWithToken,p),postWithToken:t.compose(u.requestWithToken,h),deleteWithToken:t.compose(u.requestWithToken,g),options:f}},u},u.filtersVM=r,u.paginationVM=i(n),u}e=e&&e.hasOwnProperty("default")?e["default"]:e,t=t&&t.hasOwnProperty("default")?t["default"]:t;var r=function(n){var r={},o=function(){var n=e(""),o=function(e){return arguments.length>0?(n(e),r):n()};return o.toFilter=function(){return t.isString(o())?o().trim():o()},o},i=t.reduce(n,function(e,t,n){return"between"===t?e[n]={lte:o(),gte:o()}:e[n]=o(),e},{order:o()}),u=function(){return t.reduce(i,function(e,r,o){if("order"!==o){var i=n[o];if(t.isFunction(r.toFilter)&&(void 0===r.toFilter()||""===r.toFilter()))return e;if("ilike"===i||"like"===i)e[o]=i+".*"+r.toFilter()+"*";else if("@@"===i)e[o]=i+"."+r.toFilter().replace(/\s+/g,"&");else if("between"===i){if(!r.lte.toFilter()&&!r.gte.toFilter())return e;e[o]=[],r.gte()&&e[o].push("gte."+r.gte.toFilter()),r.lte()&&e[o].push("lte."+r.lte.toFilter())}else"is.null"===i?e[o]=null===r.toFilter()?"is.null":"not.is.null":e[o]=i+"."+r.toFilter()}return e},{})},a=function(){var e=function(){return i.order()&&t.reduce(i.order(),function(e,t,n){return e.push(n+"."+t),e},[]).join(",")},n=e()?{order:e()}:{};return t.extend({},n,u())};return t.extend(r,i,{parameters:a,parametersWithoutOrder:u})},o=function(){function e(e,t){var n=[],r=!0,o=!1,i=void 0;try{for(var u,a=e[Symbol.iterator]();!(r=(u=a.next()).done)&&(n.push(u.value),!t||n.length!==t);r=!0);}catch(c){o=!0,i=c}finally{try{!r&&a["return"]&&a["return"]()}finally{if(o)throw i}}return n}return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),i=function(n){return function(n,r){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},u=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],a=e([]),c=r||"id.desc",s=e({order:c}),l=e(!1),f=e(1),d=e(),h=u?n.getPageWithToken:n.getPage,g=e(),p=function(){return new Promise(function(e,n){var r=function(e){if(!e||0===e.status)return JSON.stringify({hint:null,details:null,code:0,message:"Connection error"});var n=e.getResponseHeader("Content-Range");if(t.isString(n)){var r=n.split("/"),i=o(r,2),u=i[0],a=i[1],c=u.split("-"),s=o(c,2),l=s[0],f=s[1],h=parseInt(f)+1||0,p=parseInt(l)||0;g(parseInt(a)),d(h-p)}try{return JSON.parse(e.responseText)}catch(v){return JSON.stringify({hint:null,details:null,code:0,message:e.responseText})}};l(!0),h(s(),f(),{background:!1,extract:r},i).then(function(n){a(t.union(a(),n)),l(!1),e(a())})["catch"](function(e){l(!1),g(0),n(e)})})},v=function(e){return s(t.extend({order:c},e)),a([]),f(1),p()},m=function(){return n.pageSize()>d()},T=function(){return f(f()+1),p()};return{collection:a,firstPage:v,isLoading:l,nextPage:T,isLastPage:m,total:g,resultsCount:d}}};return n}(prop,_);